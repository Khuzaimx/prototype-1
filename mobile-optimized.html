<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <title>ClassAlarm Mobile</title>
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#2563eb" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="ClassAlarm" />
    <link rel="apple-touch-icon" href="icon-192.png" />
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Mobile-specific optimizations */
      .mobile-platform .touch-target {
        min-height: 44px;
        min-width: 44px;
      }
      
      .mobile-platform .form-input {
        font-size: 16px; /* Prevents zoom on iOS */
      }
      
      .mobile-platform .card {
        margin: 8px;
        border-radius: 12px;
      }
      
      .mobile-platform .button {
        padding: 12px 16px;
        font-size: 16px;
        border-radius: 8px;
      }
      
      /* Touch-friendly spacing */
      .touch-enabled .space-y-4 > * + * {
        margin-top: 16px;
      }
      
      .touch-enabled .gap-2 {
        gap: 12px;
      }
      
      /* Mobile navigation */
      .mobile-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: white;
        border-top: 1px solid #e5e7eb;
        padding: 8px;
        z-index: 50;
      }
      
      .mobile-nav button {
        flex: 1;
        padding: 12px;
        text-align: center;
        border-radius: 8px;
        font-size: 14px;
      }
      
      /* Hide mobile nav on desktop */
      @media (min-width: 768px) {
        .mobile-nav {
          display: none;
        }
      }
    </style>
  </head>
  <body class="bg-gray-50 pb-20">
    <div id="root"></div>
    <script type="text/javascript">
      const { useState, useEffect } = React;

      // Mobile-specific platform detection
      useEffect(() => {
        document.body.classList.add('mobile-platform');
        
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.register('/sw.js');
        }
        
        // Prevent zoom on input focus (iOS)
        const inputs = document.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
          input.addEventListener('focus', () => {
            input.style.fontSize = '16px';
          });
        });
      }, []);

      function AuthScreen({ onLogin }) {
        const [email, setEmail] = useState('');
        const [error, setError] = useState('');

        const handleSubmit = (e) => {
          e.preventDefault();
          const lower = (email || '').trim().toLowerCase();
          let role = null;
          if (lower === 'student@class.com') role = 'student';
          if (lower === 'cr@class.com') role = 'cr';
          if (!role) {
            setError('Use student@class.com or cr@class.com');
            return;
          }
          onLogin({ email: lower, role });
        };

        return (
          React.createElement('div', { className: 'min-h-screen flex items-center justify-center px-4' },
            React.createElement('div', { className: 'w-full max-w-sm bg-white rounded-lg shadow p-6 space-y-6' },
              React.createElement('div', { className: 'text-center' },
                React.createElement('h1', { className: 'text-2xl font-bold text-gray-900' }, 'ClassAlarm'),
                React.createElement('p', { className: 'text-sm text-gray-500 mt-2' }, 'Sign in to continue')
              ),
              React.createElement('form', { onSubmit: handleSubmit, className: 'space-y-4' },
                React.createElement('div', null,
                  React.createElement('label', { htmlFor: 'email', className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Email'),
                  React.createElement('input', {
                    id: 'email', type: 'email', value: email, onChange: (e) => setEmail(e.target.value),
                    placeholder: 'student@class.com or cr@class.com',
                    className: 'w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 form-input'
                  })
                ),
                error && React.createElement('div', { className: 'text-sm text-red-600' }, error),
                React.createElement('button', { type: 'submit', className: 'w-full px-4 py-3 rounded-lg bg-blue-600 text-white font-medium hover:bg-blue-700 button' }, 'Continue')
              ),
              React.createElement('div', { className: 'text-xs text-gray-500 text-center' }, 'Prototype login only')
            )
          )
        );
      }

      function CRPanel({ classes, setClasses }) {
        const [formData, setFormData] = useState({ subject: '', venue: '', date: '', time: '', note: '', attachmentName: '', attachmentDataUrl: '' });
        const [editingId, setEditingId] = useState(null);
        const [editForm, setEditForm] = useState({ subject: '', venue: '', date: '', time: '', note: '' });

        const handleInputChange = (e) => {
          const { name, value } = e.target;
          setFormData(prev => ({ ...prev, [name]: value }));
        };

        const handleSubmit = (e) => {
          e.preventDefault();
          const newClass = {
            id: Date.now(),
            subject: formData.subject.trim(),
            venue: formData.venue.trim(),
            date: formData.date,
            time: formData.time,
            note: (formData.note || '').trim(),
            attachmentName: formData.attachmentName || '',
            attachmentDataUrl: formData.attachmentDataUrl || ''
          };
          const updated = [newClass, ...classes];
          setClasses(updated);
          try { localStorage.setItem('classes', JSON.stringify(updated)); } catch (_) {}
          alert('Class submitted!');
          setFormData({ subject: '', venue: '', date: '', time: '', note: '', attachmentName: '', attachmentDataUrl: '' });
        };

        const handleDelete = (id) => {
          const updated = classes.filter(c => c.id !== id);
          setClasses(updated);
          try { localStorage.setItem('classes', JSON.stringify(updated)); } catch (_) {}
        };

        return (
          React.createElement('div', { className: 'space-y-6 px-4' },
            React.createElement('div', { className: 'bg-white rounded-lg shadow p-4 card' },
              React.createElement('h2', { className: 'text-lg font-semibold text-gray-900 mb-4' }, 'Submit New Class'),
              React.createElement('form', { onSubmit: handleSubmit, className: 'space-y-4' },
                React.createElement('div', { className: 'space-y-4' },
                  React.createElement('div', null,
                    React.createElement('label', { htmlFor: 'subject', className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Subject'),
                    React.createElement('select', {
                      id: 'subject', name: 'subject', value: formData.subject, onChange: handleInputChange, required: true,
                      className: 'w-full px-3 py-3 border border-gray-300 rounded-lg shadow-sm bg-white focus:outline-none focus:ring-blue-500 focus:border-blue-500 form-input'
                    },
                      [
                        '', 'se221', 'cs221', 'ee201', 'math101', 'phy201', 'is301'
                      ].map((opt, idx) => (
                        React.createElement('option', { key: idx, value: opt }, opt === '' ? 'Select subject' : opt.toUpperCase())
                      ))
                    )
                  ),
                  React.createElement('div', null,
                    React.createElement('label', { htmlFor: 'venue', className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Venue'),
                    React.createElement('select', {
                      id: 'venue', name: 'venue', value: formData.venue, onChange: handleInputChange, required: true,
                      className: 'w-full px-3 py-3 border border-gray-300 rounded-lg shadow-sm bg-white focus:outline-none focus:ring-blue-500 focus:border-blue-500 form-input'
                    },
                      [
                        '', 'acb-lh1','acb-lh2','acb-lh3','acb-lh4','acb-lh5','acb-lh6','acb-lh7','fsce-lh1','fsce-lh2'
                      ].map((opt, idx) => (
                        React.createElement('option', { key: idx, value: opt }, opt === '' ? 'Select venue' : opt.toUpperCase())
                      ))
                    )
                  ),
                  React.createElement('div', { className: 'grid grid-cols-2 gap-3' },
                    React.createElement('div', null,
                      React.createElement('label', { htmlFor: 'date', className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Date'),
                      React.createElement('input', {
                        type: 'date', id: 'date', name: 'date', value: formData.date, onChange: handleInputChange,
                        required: true, className: 'w-full px-3 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 form-input'
                      })
                    ),
                    React.createElement('div', null,
                      React.createElement('label', { htmlFor: 'time', className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Time'),
                      React.createElement('input', {
                        type: 'time', id: 'time', name: 'time', value: formData.time, onChange: handleInputChange,
                        required: true, className: 'w-full px-3 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 form-input'
                      })
                    )
                  ),
                  React.createElement('div', null,
                    React.createElement('label', { htmlFor: 'note', className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Note (optional)'),
                    React.createElement('textarea', {
                      id: 'note', name: 'note', value: formData.note, onChange: handleInputChange,
                      rows: 3, placeholder: 'Any extra info for students...',
                      className: 'w-full px-3 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 resize-none form-input'
                    })
                  ),
                  React.createElement('div', null,
                    React.createElement('label', { htmlFor: 'attachment', className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Attachment (optional)'),
                    React.createElement('input', {
                      type: 'file', id: 'attachment', name: 'attachment',
                      onChange: (e) => {
                        const file = e.target.files && e.target.files[0];
                        if (!file) {
                          setFormData(prev => ({ ...prev, attachmentName: '', attachmentDataUrl: '' }));
                          return;
                        }
                        const reader = new FileReader();
                        reader.onload = () => {
                          setFormData(prev => ({ ...prev, attachmentName: file.name, attachmentDataUrl: reader.result }));
                        };
                        reader.readAsDataURL(file);
                      },
                      className: 'w-full px-3 py-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 form-input'
                    }),
                    formData.attachmentName && React.createElement('div', { className: 'mt-2 text-sm text-gray-500' }, 'Selected: ', formData.attachmentName)
                  )
                ),
                React.createElement('div', { className: 'pt-4' },
                  React.createElement('button', { type: 'submit', className: 'w-full px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 button' }, 'Submit Class')
                )
              )
            ),
            React.createElement('div', { className: 'bg-white rounded-lg shadow p-4 card' },
              React.createElement('h2', { className: 'text-lg font-semibold text-gray-900 mb-4' }, 'Submitted Classes'),
              classes.length === 0
                ? React.createElement('p', { className: 'text-gray-500 text-center py-8' }, 'No classes submitted yet.')
                : React.createElement('div', { className: 'space-y-3' },
                    classes.map(classItem => (
                      React.createElement('div', { key: classItem.id, className: 'border border-gray-200 rounded-lg p-3' },
                        React.createElement('div', { className: 'space-y-2' },
                          React.createElement('h3', { className: 'text-base font-medium text-gray-900' }, classItem.subject),
                          React.createElement('div', { className: 'text-sm text-gray-600' },
                            React.createElement('div', { className: 'flex items-center' }, '📍 ', classItem.venue),
                            React.createElement('div', { className: 'flex items-center' }, '📅 ', new Date(classItem.date).toLocaleDateString()),
                            React.createElement('div', { className: 'flex items-center' }, '🕐 ', classItem.time)
                          ),
                          classItem.note && React.createElement('div', { className: 'text-sm text-gray-500 italic' }, 'Note: ', classItem.note),
                          classItem.attachmentName && React.createElement('div', { className: 'text-sm text-gray-600' }, '📎 ', classItem.attachmentName),
                          React.createElement('div', { className: 'flex gap-2 pt-2' },
                            React.createElement('button', { onClick: () => handleDelete(classItem.id), className: 'flex-1 px-3 py-2 text-sm rounded-md border border-red-200 text-red-600 hover:bg-red-50 button' }, 'Delete')
                          )
                        )
                      )
                    ))
                  )
            )
          )
        );
      }

      function StudentPanel({ classes }) {
        const fallback = [
          { id: 1, subject: 'Data Structures', venue: 'Room 101', time: '09:00' },
          { id: 2, subject: 'Algorithms', venue: 'Lab 205', time: '11:00' },
          { id: 3, subject: 'Web Development', venue: 'Room 203', time: '14:00' },
          { id: 4, subject: 'Machine Learning', venue: 'Lab 301', time: '16:00' }
        ];

        const pad2 = (n) => (n < 10 ? `0${n}` : `${n}`);
        const nowLocal = new Date();
        const todayStr = `${nowLocal.getFullYear()}-${pad2(nowLocal.getMonth() + 1)}-${pad2(nowLocal.getDate())}`;
        const todaysClasses = (classes || []).filter(c => c.date === todayStr).map(c => ({ id: c.id, subject: c.subject, venue: c.venue, time: c.time, attachmentName: c.attachmentName, attachmentDataUrl: c.attachmentDataUrl }));
        const list = todaysClasses.length ? todaysClasses : fallback;

        const getCurrentTime = () => new Date().toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit' });

        const getTimeUntilClass = (classTime) => {
          const now = new Date();
          const [hours, minutes] = classTime.split(':');
          const classDateTime = new Date();
          classDateTime.setHours(parseInt(hours), parseInt(minutes), 0, 0);
          const diffMs = classDateTime - now;
          const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
          const diffMinutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
          if (diffMs < 0) return 'Class has ended';
          if (diffHours > 0) return `${diffHours}h ${diffMinutes}m until class`;
          return `${diffMinutes}m until class`;
        };

        return (
          React.createElement('div', { className: 'space-y-4 px-4' },
            React.createElement('div', { className: 'bg-white rounded-lg shadow p-4 card' },
              React.createElement('div', { className: 'flex justify-between items-center' },
                React.createElement('h2', { className: 'text-lg font-semibold text-gray-900' }, "Today's Classes"),
                React.createElement('div', { className: 'text-sm text-gray-600' }, getCurrentTime())
              )
            ),
            React.createElement('div', { className: 'space-y-3' },
              list.length === 0
                ? React.createElement('div', { className: 'bg-white rounded-lg shadow p-6 text-center card' },
                    React.createElement('p', { className: 'text-gray-500 text-lg' }, 'No classes today!'),
                    React.createElement('p', { className: 'text-gray-400 text-sm mt-2' }, 'Enjoy your free time! 🎉')
                  )
                : list.map(classItem => (
                    React.createElement('div', { key: classItem.id, className: 'bg-white rounded-lg shadow p-4 card' },
                      React.createElement('div', { className: 'space-y-3' },
                        React.createElement('div', null,
                          React.createElement('h3', { className: 'text-lg font-semibold text-gray-900' }, classItem.subject),
                          React.createElement('div', { className: 'text-sm text-gray-600 space-y-1' },
                            React.createElement('div', { className: 'flex items-center' }, '📍 ', classItem.venue),
                            React.createElement('div', { className: 'flex items-center' }, '🕐 ', classItem.time)
                          ),
                          React.createElement('div', { className: 'text-sm text-gray-500 mt-2' }, getTimeUntilClass(classItem.time))
                        ),
                        classItem.attachmentName && classItem.attachmentDataUrl && React.createElement('a', {
                          href: classItem.attachmentDataUrl,
                          download: classItem.attachmentName,
                          className: 'block w-full px-4 py-2 text-sm rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 text-center button'
                        }, '⬇️ Download ', classItem.attachmentName),
                        React.createElement('div', { className: 'bg-blue-50 border border-blue-200 rounded-lg p-3 text-center' },
                          React.createElement('div', { className: 'text-blue-600 text-sm font-medium' }, '⏰ Alarm set 20 minutes before class'),
                          React.createElement('div', { className: 'text-blue-500 text-xs mt-1' }, (function() {
                            const [hours, minutes] = classItem.time.split(':');
                            const alarmTime = new Date();
                            alarmTime.setHours(parseInt(hours), parseInt(minutes) - 20, 0, 0);
                            return `Alarm at ${alarmTime.toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit' })}`;
                          })())
                        )
                      )
                    )
                  ))
            ),
            list.length > 0 && React.createElement('div', { className: 'bg-white rounded-lg shadow p-4 card' },
              React.createElement('h3', { className: 'text-lg font-semibold text-gray-900 mb-4' }, "Today's Summary"),
              React.createElement('div', { className: 'grid grid-cols-3 gap-3 text-center' },
                React.createElement('div', { className: 'bg-gray-50 rounded-lg p-3' },
                  React.createElement('div', { className: 'text-xl font-bold text-gray-900' }, list.length),
                  React.createElement('div', { className: 'text-xs text-gray-600' }, 'Total')
                ),
                React.createElement('div', { className: 'bg-green-50 rounded-lg p-3' },
                  React.createElement('div', { className: 'text-xl font-bold text-green-600' }, list.filter(c => {
                    const [hours, minutes] = c.time.split(':');
                    const classTime = new Date();
                    classTime.setHours(parseInt(hours), parseInt(minutes), 0, 0);
                    return classTime > new Date();
                  }).length),
                  React.createElement('div', { className: 'text-xs text-green-600' }, 'Upcoming')
                ),
                React.createElement('div', { className: 'bg-blue-50 rounded-lg p-3' },
                  React.createElement('div', { className: 'text-xl font-bold text-blue-600' }, list.filter(c => {
                    const [hours, minutes] = c.time.split(':');
                    const classTime = new Date();
                    classTime.setHours(parseInt(hours), parseInt(minutes), 0, 0);
                    const alarmTime = new Date(classTime.getTime() - 20 * 60 * 1000);
                    return alarmTime > new Date() && classTime > new Date();
                  }).length),
                  React.createElement('div', { className: 'text-xs text-blue-600' }, 'Alarms')
                )
              )
            )
          )
        );
      }

      function App() {
        const [activeTab, setActiveTab] = React.useState('cr');
        const [session, setSession] = React.useState(() => {
          try { return JSON.parse(localStorage.getItem('session') || 'null'); } catch (_) { return null; }
        });
        const initialClasses = (() => {
          const defaults = [
            { id: 1, subject: 'Data Structures', venue: 'Room 101', date: '2024-01-15', time: '09:00' },
            { id: 2, subject: 'Algorithms', venue: 'Lab 205', date: '2024-01-15', time: '11:00' },
            { id: 3, subject: 'Database Systems', venue: 'Room 302', date: '2024-01-16', time: '14:00' }
          ];
          try {
            const saved = localStorage.getItem('classes');
            return saved ? JSON.parse(saved) : defaults;
          } catch (_) {
            return defaults;
          }
        })();
        const [classes, setClasses] = React.useState(initialClasses);
        
        const handleLogin = (payload) => {
          setSession(payload);
          try { localStorage.setItem('session', JSON.stringify(payload)); } catch (_) {}
          setActiveTab(payload.role === 'cr' ? 'cr' : 'student');
        };

        const handleLogout = () => {
          setSession(null);
          try { localStorage.removeItem('session'); } catch (_) {}
        };

        return (
          React.createElement('div', { className: 'min-h-screen bg-gray-50' },
            React.createElement('header', { className: 'bg-white shadow-sm border-b' },
              React.createElement('div', { className: 'px-4 py-3' },
                React.createElement('div', { className: 'flex justify-between items-center' },
                  React.createElement('h1', { className: 'text-lg font-bold text-gray-900' }, 'ClassAlarm'),
                  React.createElement('div', { className: 'flex items-center gap-2' },
                    session && React.createElement('span', { className: 'text-xs text-gray-600' }, session.role.toUpperCase()),
                    session && React.createElement('button', { onClick: handleLogout, className: 'px-2 py-1 text-xs rounded-md border border-gray-300 hover:bg-gray-50' }, 'Sign out')
                  )
                )
              )
            ),
            session
              ? React.createElement(React.Fragment, null,
                  React.createElement('main', { className: 'py-4' },
                    (session.role === 'cr' && activeTab === 'cr')
                      ? React.createElement(CRPanel, { classes, setClasses })
                      : React.createElement(StudentPanel, { classes })
                  ),
                  React.createElement('div', { className: 'mobile-nav' },
                    React.createElement('div', { className: 'flex gap-2' },
                      React.createElement('button', {
                        onClick: () => setActiveTab('cr'), disabled: session.role !== 'cr',
                        className: `flex-1 py-2 px-3 rounded-lg text-sm font-medium ${activeTab === 'cr' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-600'} ${session.role !== 'cr' ? 'opacity-50' : ''}`
                      }, 'CR Panel'),
                      React.createElement('button', {
                        onClick: () => setActiveTab('student'),
                        className: `flex-1 py-2 px-3 rounded-lg text-sm font-medium ${activeTab === 'student' ? 'bg-blue-600 text-white' : 'bg-gray-100 text-gray-600'}`
                      }, 'Student Panel')
                    )
                  )
                )
              : React.createElement(AuthScreen, { onLogin: handleLogin })
          )
        );
      }

      const rootElement = document.getElementById('root');
      const root = ReactDOM.createRoot(rootElement);
      root.render(React.createElement(React.StrictMode, null, React.createElement(App)));
    </script>
  </body>
</html>
